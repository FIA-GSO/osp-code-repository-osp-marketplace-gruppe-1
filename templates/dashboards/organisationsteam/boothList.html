<!doctype html>
<html>
<head>
  <link rel="stylesheet" href="static/bootstrap/css/bootstrap.min.css">
  <script src="static/bootstrap/js/bootstrap.min.js"></script>
  <style>
    .event-block { display: none; }
    .event-block.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <select id="eventSelect">
    {% for event in events %}
        <option {% if loop.first %}selected{% endif %} value="{{ event.uid }}">{{ event.date }}</option>
    {% endfor %}
    </select>

    {% for event in events %}
    <div class="event-block" data-uid="{{ event.uid }}">
      <div>
        {% if eventBooths[event.uid] %}
        <h6>Stände</h6>
          {% for eventBooth in eventBooths[event.uid] %}
            <div>
              Unternehmen: INSERT_UNTERNEHMEN_HERE
              <br>
              Vorname: <span>{{ eventBooth.first_name }}</span>
              <br>
              Nachanme: <span>{{ eventBooth.last_name }}</span>
              <br>
              Status: <span>{{ eventBooth.status }}</span>
              <br>
              E-Mail: <span>{{ eventBooth.email }}</span>
              <br>
              Telefon: <span>{{ eventBooth.telephone }}</span>
              <br>
              Anmerkung: <span>{{ eventBooth.note }}</span>
              <br>
              Tische: <span>{{ eventBooth.table_count }}</span>
              <br>
              Stühle: <span>{{ eventBooth.chair_count }}</span>
            </div>
            <button class="js-button" event-id="{{ event.uid }}" action="accept">Annehmen</button>
            <button class="js-button" event-id="{{ event.uid }}" action="reject">Ablehnen</button>
            {{ eventBooth }}
          {% endfor %}
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <script>
    (function(){
      const select = document.getElementById('eventSelect');
      const blocks = document.querySelectorAll('.event-block');

      function showUid(uid) {
        blocks.forEach(b => {
          if (!uid) {
            b.classList.remove('active');
          } else {
            b.classList.toggle('active', b.dataset.uid === uid);
          }
        });
      }

      select.addEventListener('change', e => {
        showUid(e.target.value);
      });
      showUid(select.value);
    })();

    document.querySelectorAll('.js-button').forEach(btn =>
      btn.addEventListener('click', async event => {
        event.preventDefault();
        userId = btn.getAttribute('event-id');
        action = btn.getAttribute('action');

        if (action === 'accept') {
          const res = await fetch('/api/booths', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 'action': action, 'uid': userId }),
          });
        }

        console.log(event);
      })
    );

  </script>
</body>
</html>
